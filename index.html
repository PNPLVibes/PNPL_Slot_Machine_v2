<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0a0010" />
  <title>PNPL Vibes â€” Optimized Slots</title>

  <style>
    /* ==========================
       CSS VARIABLES & BASE RESET
       ========================== */
    :root{
      --bg-1:#0a0410;
      --accent-1: #DA70D6;
      --accent-2: #FF69B4;
      --accent-3: #FF1493;
      --glass: rgba(255,255,255,0.06);
      --card-radius: 20px;
      --reel-gap: 20px;
      --symbol-count: 6; /* number of unique symbols */
      --symbol-height: 260px; /* fallback, updated in JS */
    }

    /* Minimal reset */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: linear-gradient(180deg,#120316 0%, #000 100%);
      color:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
      padding:20px;
      display:flex;
      align-items:center;
      justify-content:center;
      min-height:100vh;
    }

    /* Respect reduce-motion */
    @media (prefers-reduced-motion: reduce){
      *{animation-duration:0.001ms!important;animation-iteration-count:1!important;transition-duration:0.001ms!important}
    }

    /* ================
       Background Layers
       ================ */
    .bg-layer{position:fixed;inset:0;pointer-events:none;z-index:-3}
    .gradient-bg{background:radial-gradient(ellipse at center,#2d1b3d 0%, #050007 50%, #000 100%);opacity:0.95}
    .conic-rays{
      position:fixed;inset:0;mix-blend-mode:overlay;opacity:0.18;filter:blur(14px);
      background:conic-gradient(from 0deg,#0000 0deg, rgba(218,112,214,0.12) 40deg, #0000 80deg);
      animation:rotate 30s linear infinite;
    }
    @keyframes rotate{to{transform:rotate(360deg)}}

    /* Particles (low-cost on mobile) */
    .particles{position:fixed;inset:0;z-index:-2;pointer-events:none;opacity:0.35}
    .particle{position:absolute;border-radius:999px;will-change:transform,opacity;transform:translate3d(0,0,0)}
    
    /* ===================
       Container & Machine
       =================== */
    .machine-wrap{
      width:100%;
      max-width:1100px;
      padding:12px;
      perspective:1600px;
      display:flex;
      justify-content:center;
    }

    .machine{
      width:100%;
      border-radius:28px;
      background:linear-gradient(135deg,#110018, #0b0410);
      padding:28px;
      box-shadow:0 24px 60px rgba(0,0,0,0.7), 0 8px 30px rgba(218,112,214,0.08);
      border:1px solid rgba(218,112,214,0.15);
      position:relative;
      overflow:hidden;
      transform-style:preserve-3d;
    }

    /* Chrome trim */
    .trim{
      pointer-events:none;
      position:absolute;inset:0;border-radius:32px;
      background:linear-gradient(135deg, rgba(255,255,255,0.03), transparent 25%, rgba(255,255,255,0.02));
      mix-blend-mode:screen;
    }

    /* TOP: logo + tagline (no negative margins) */
    .machine-top{
      text-align:center;
      padding:18px 8px 12px 8px;
      margin-bottom:18px;
      border-bottom:1px solid rgba(255,255,255,0.02);
    }

    .logo{
      font-family:"Playfair Display",serif;
      font-weight:800;
      font-size:44px;
      letter-spacing:5px;
      text-transform:uppercase;
      background:linear-gradient(90deg,var(--accent-1),var(--accent-2),var(--accent-3));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      display:inline-block;
      filter:drop-shadow(0 0 22px rgba(218,112,214,0.5));
    }
    .tagline{
      display:block;margin-top:8px;color:rgba(218,112,214,0.75);font-size:12px;letter-spacing:6px;text-transform:uppercase;
    }

    /* Display / stats */
    .display{
      background:linear-gradient(145deg,rgba(0,0,0,0.6),rgba(10,5,15,0.5));
      border-radius:16px;padding:14px;margin-bottom:20px;border:1px solid rgba(218,112,214,0.08);
    }
    .stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .stat{background:rgba(0,0,0,0.45);padding:10px;border-radius:10px;text-align:center;border:1px solid rgba(218,112,214,0.06)}
    .stat .label{font-size:10px;color:rgba(255,255,255,0.6);letter-spacing:2px;text-transform:uppercase}
    .stat .value{font-family:monospace;font-weight:800;color:var(--accent-2);font-size:24px}

    /* Reels frame */
    .reels-frame{
      background:linear-gradient(180deg,#070308,#0a050e);
      border-radius:18px;padding:18px;margin:18px 0;border:1px solid rgba(218,112,214,0.06);
      position:relative;overflow:visible;
    }
    .lightbar{height:8px;width:80%;margin:6px auto 12px;border-radius:6px;background:linear-gradient(90deg,transparent,var(--accent-1),var(--accent-2));opacity:0.7}

    .reels{
      display:flex;gap:var(--reel-gap);justify-content:center;align-items:center;flex-wrap:nowrap;padding:6px;
      perspective:1200px;
    }

    .reel-wrap{position:relative;flex:0 0 auto}
    .reel{
      width:220px;height:var(--symbol-height);
      border-radius:16px;border:3px solid rgba(218,112,214,0.09);
      overflow:hidden;position:relative;background:linear-gradient(180deg,#030002,#120016);
      display:block;will-change:transform;
      box-shadow:inset 0 8px 40px rgba(0,0,0,0.6);
    }

    .reel-inner{
      position:absolute;left:0;top:0;width:100%;transition:transform 700ms cubic-bezier(.2,.9,.2,1);will-change:transform;
    }

    .symbol{
      height:var(--symbol-height);display:flex;align-items:center;justify-content:center;font-size:96px;
      flex-direction:column;padding:6px;text-align:center;user-select:none;
      text-shadow:0 2px 10px rgba(0,0,0,0.6);
      will-change:transform,opacity;
    }
    .symbol-label{font-size:12px;margin-top:8px;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.8);font-weight:700}

    /* win line */
    .win-line{
      position:absolute;left:-12%;width:124%;height:6px;top:50%;transform:translateY(-50%);
      background:linear-gradient(90deg,transparent,var(--accent-1),var(--accent-2),transparent);border-radius:3px;
      box-shadow:0 0 22px rgba(218,112,214,0.9);opacity:0;pointer-events:none;z-index:3;
    }
    .win-line.active{opacity:1;animation:winPulse 600ms ease-in-out infinite}
    @keyframes winPulse{50%{transform:translateY(-50%) scaleX(1.03)}}

    /* glow when spinning */
    .reel-glow{position:absolute;inset:-12px;border-radius:18px;opacity:0;pointer-events:none}
    .spinning .reel-glow{opacity:1;filter:blur(16px)}

    /* message */
    .message{
      text-align:center;margin-top:12px;padding:14px;border-radius:12px;background:linear-gradient(180deg,rgba(0,0,0,0.55),rgba(0,0,0,0.45));
      border:1px solid rgba(218,112,214,0.06);min-height:64px;display:flex;align-items:center;justify-content:center;
    }
    .message .text{font-weight:900;font-size:22px;letter-spacing:2px;color:var(--accent-2);text-transform:uppercase}

    /* controls */
    .controls{display:flex;flex-direction:column;gap:14px;margin-top:14px}
    .bet-row{display:flex;gap:12px;align-items:center;justify-content:center;flex-wrap:wrap}
    .bet-btn{width:56px;height:56px;border-radius:999px;border:3px solid rgba(218,112,214,0.08);background:linear-gradient(180deg,#160722,#21072a);color:var(--accent-2);font-weight:900;font-size:20px;cursor:pointer}
    .bet-display{min-width:120px;padding:10px 18px;border-radius:12px;background:linear-gradient(180deg,#050205,#170018);text-align:center;font-family:monospace;font-weight:900;font-size:20px;color:var(--accent-2);border:1px solid rgba(218,112,214,0.06)}
    .spin-wrap{text-align:center}
    .spin-btn{padding:14px 36px;border-radius:999px;border:none;font-weight:900;font-size:18px;cursor:pointer;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:#000;box-shadow:0 10px 30px rgba(0,0,0,0.4)}

    /* paytable */
    .paytable{margin-top:18px;border-radius:12px;padding:14px;background:linear-gradient(180deg,rgba(10,2,10,0.6),rgba(4,0,6,0.6));border:1px solid rgba(218,112,214,0.04)}
    .paygrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
    .payitem{display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(0,0,0,0.35);border-radius:10px;border:1px solid rgba(218,112,214,0.02)}

    /* confetti (limited) */
    .celebration{position:fixed;inset:0;pointer-events:none;z-index:1200}

    /* small screens */
    @media (max-width:820px){
      .logo{font-size:32px;letter-spacing:4px}
      .reel{width:110px}
      :root{--symbol-height:130px}
      .symbol{font-size:48px}
      .bet-display{min-width:90px;font-size:18px}
      .spin-btn{padding:12px 24px;font-size:16px}
      .stat .value{font-size:18px}
    }

    @media (max-width:420px){
      body{padding:12px}
      .reels{gap:10px}
      :root{--reel-gap:10px}
      .reel{width:98px}
      .logo{font-size:26px}
      .tagline{letter-spacing:3px}
    }

    /* focus + accessible */
    button:focus{outline:3px solid rgba(255,255,255,0.06);outline-offset:3px}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
  </style>
</head>
<body>
  <!-- Background layers -->
  <div class="bg-layer gradient-bg" aria-hidden="true"></div>
  <div class="bg-layer conic-rays" aria-hidden="true"></div>
  <div class="particles" id="particles" aria-hidden="true"></div>

  <div class="machine-wrap">
    <main class="machine" role="application" aria-label="PNPL Vibes slot machine">
      <div class="trim" aria-hidden="true"></div>

      <header class="machine-top">
        <div class="logo">PNPL Vibes</div>
        <div class="tagline">Exclusive Lifestyle Experience</div>
      </header>

      <section class="display" aria-labelledby="display-label">
        <div id="display-label" class="sr-only">Player stats</div>
        <div class="stats">
          <div class="stat">
            <div class="label">Credits</div>
            <div class="value" id="credits">1000</div>
          </div>
          <div class="stat">
            <div class="label">Current Bet</div>
            <div class="value" id="current-bet">10</div>
          </div>
          <div class="stat">
            <div class="label">Last Win</div>
            <div class="value" id="last-win">0</div>
          </div>
        </div>
      </section>

      <section class="reels-frame" aria-label="Slot reels">
        <div class="lightbar" aria-hidden="true"></div>
        <div class="reels" id="reels" aria-hidden="false">
          <!-- Three reels (populated by JS) -->
        </div>

        <div class="message" role="status" aria-live="polite">
          <div class="text" id="message">Place Your Bet</div>
        </div>
      </section>

      <section class="controls" aria-label="Controls">
        <div class="bet-row" aria-hidden="false">
          <button id="bet-down" class="bet-btn" aria-label="Decrease bet">âˆ’</button>
          <div class="bet-display" id="bet-display">10</div>
          <button id="bet-up" class="bet-btn" aria-label="Increase bet">+</button>
        </div>

        <div class="spin-wrap">
          <button id="spin" class="spin-btn" aria-live="polite">Spin</button>
        </div>
      </section>

      <section class="paytable" aria-label="Paytable">
        <div class="paygrid" id="paygrid">
          <!-- populated by JS -->
        </div>
      </section>
    </main>
  </div>

  <div class="celebration" id="celebration" aria-hidden="true"></div>

  <script>
    /* ==================================================
       JS NOTES:
       - Responsive symbol/reel heights are computed at run.
       - Transforms use numeric pixel offsets so there's no jump.
       - Particle/confetti counts adapt to viewport to avoid jank on mobile.
       - Accessible keyboard support: Enter/Space on Spin button.
       ================================================== */

    (function(){
      "use strict";

      // Symbols (master list)
      const symbols = [
        { icon: 'ðŸ’Ž', label: 'Diamond', payout: 100 },
        { icon: 'ðŸ¾', label: 'Champagne', payout: 50 },
        { icon: 'ðŸŽ­', label: 'Masquerade', payout: 30 },
        { icon: 'ðŸŒ¹', label: 'Romance', payout: 25 },
        { icon: 'ðŸŽª', label: 'Party', payout: 20 },
        { icon: 'ðŸ’ƒ', label: 'Dance', payout: 15 }
      ];

      // State
      let credits = 1000;
      let bet = 10;
      let isSpinning = false;
      let lastWin = 0;
      const maxBet = 100;

      // DOM elements
      const creditsEl = document.getElementById('credits');
      const currentBetEl = document.getElementById('current-bet');
      const lastWinEl = document.getElementById('last-win');
      const betDisplayEl = document.getElementById('bet-display');
      const messageEl = document.getElementById('message');
      const spinBtn = document.getElementById('spin');
      const betUpBtn = document.getElementById('bet-up');
      const betDownBtn = document.getElementById('bet-down');
      const reelsEl = document.getElementById('reels');
      const paygridEl = document.getElementById('paygrid');
      const celebrationEl = document.getElementById('celebration');

      let reelCount = 3;
      let symbolHeight = 260; // will be recalculated
      let innerElements = []; // store inner containers for quick access
      let winLines = []; // store win-line els

      // Utility: clamp
      function clamp(v,min,max){return Math.max(min, Math.min(max, v))}

      // Accessibility: keyboard support (Enter/Space to spin)
      spinBtn.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' '){
          e.preventDefault();
          spin();
        }
      });

      /* =========================
         Layout & DOM initialization
         ========================= */
      function buildPaytable(){
        paygridEl.innerHTML = '';
        symbols.forEach(s=>{
          const item = document.createElement('div');
          item.className = 'payitem';
          item.innerHTML = `<div style="font-size:22px">${s.icon} ${s.icon} ${s.icon}</div><div style="font-weight:800">${s.payout}x</div>`;
          paygridEl.appendChild(item);
        });
      }

      function buildReels(){
        reelsEl.innerHTML = '';
        innerElements = [];
        winLines = [];

        // compute symbolHeight from CSS variable or element
        const computedRoot = getComputedStyle(document.documentElement);
        const rootSymbolHeight = parseInt(computedRoot.getPropertyValue('--symbol-height')) || 260;
        // if on mobile viewport smaller widths reduce height
        const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        if(vw <= 420){
          symbolHeight = Math.round(rootSymbolHeight / 2);
        } else if (vw <= 820){
          symbolHeight = Math.round(rootSymbolHeight / 2);
        } else {
          symbolHeight = rootSymbolHeight;
        }

        // Set CSS variable to keep sync
        document.documentElement.style.setProperty('--symbol-height', symbolHeight + 'px');

        for(let r=0;r<reelCount;r++){
          const wrap = document.createElement('div');
          wrap.className = 'reel-wrap';
          const reel = document.createElement('div');
          reel.className = 'reel';
          reel.setAttribute('data-reel', String(r));

          // win line
          const winLine = document.createElement('div');
          winLine.className = 'win-line';
          reel.appendChild(winLine);
          winLines.push(winLine);

          // inner
          const inner = document.createElement('div');
          inner.className = 'reel-inner';

          // create repeated sequence so spin can scroll smoothly (duplicate list)
          const repeats = 6; // enough to avoid edge-case jumps
          const seq = [];
          for(let i=0;i<repeats;i++) seq.push(...symbols);

          seq.forEach(sym=>{
            const sdiv = document.createElement('div');
            sdiv.className = 'symbol';
            sdiv.style.height = symbolHeight + 'px';
            sdiv.innerHTML = `<div style="font-size:calc(${symbolHeight} / 2.5)">${sym.icon}</div><div class="symbol-label">${sym.label}</div>`;
            inner.appendChild(sdiv);
          });

          // set size of inner container
          inner.style.transform = `translateY(0px)`;
          reel.appendChild(inner);

          // glow element
          const glow = document.createElement('div');
          glow.className = 'reel-glow';
          glow.style.background = `radial-gradient(circle, rgba(218,112,214,0.18) 0%, transparent 60%)`;
          reel.appendChild(glow);

          wrap.appendChild(reel);
          reelsEl.appendChild(wrap);
          innerElements.push({inner,seq});
        }
      }

      /* =======================
         Particles & Celebration
         ======================= */
      function createParticles(){
        const container = document.getElementById('particles');
        container.innerHTML = '';
        const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        const particleCount = vw < 420 ? 12 : vw < 820 ? 22 : 40;

        for(let i=0;i<particleCount;i++){
          const p = document.createElement('div');
          p.className = 'particle';
          const size = Math.round(Math.random() * 6 + 2);
          p.style.width = p.style.height = size + 'px';
          p.style.left = Math.random() * 100 + '%';
          p.style.top = Math.random() * 100 + '%';
          p.style.background = `radial-gradient(circle, rgba(218,112,214,${0.6+Math.random()*0.4}) 0%, transparent 60%)`;
          p.style.transform = `translate3d(0,0,0) scale(${0.5 + Math.random()*1.6})`;
          container.appendChild(p);
        }
      }

      function createConfetti(){
        // adaptive confetti for performance
        const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
        const count = vw < 420 ? 30 : vw < 820 ? 60 : 100;
        const colors = ['#FF69B4', '#DA70D6', '#FFB6C1', '#FF1493', '#C71585'];

        for(let i=0;i<count;i++){
          // small stagger so not all in same frame
          setTimeout(()=>{
            const el = document.createElement('div');
            el.className = 'confetti';
            el.style.position = 'absolute';
            el.style.left = Math.random()*100 + '%';
            el.style.top = '-5%';
            el.style.width = Math.floor(Math.random()*8 + 6)+'px';
            el.style.height = Math.floor(Math.random()*10 + 6)+'px';
            el.style.background = colors[Math.floor(Math.random()*colors.length)];
            el.style.borderRadius = (Math.random()>0.5? '2px':'50%');
            el.style.opacity = '0.95';
            el.style.transform = `translate3d(0,0,0)`;
            celebrationEl.appendChild(el);

            // simple fall using CSS transitions to keep it cheap
            requestAnimationFrame(()=>{
              el.style.transition = `transform ${1.8 + Math.random()*1.4}s cubic-bezier(.2,.9,.2,1), opacity 1.8s`;
              const x = (Math.random() - 0.5) * 50;
              const y = window.innerHeight + 200;
              el.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(${Math.random()*720}deg)`;
              el.style.opacity = '0';
            });

            // remove after animation
            setTimeout(()=>el.remove(), 3200);
          }, i * 12);
        }
      }

      /* ==================
         Update UI / Display
         ================== */
      function updateDisplay(){
        creditsEl.textContent = String(credits);
        currentBetEl.textContent = String(bet);
        lastWinEl.textContent = String(lastWin);
        betDisplayEl.textContent = String(bet);
        spinBtn.disabled = isSpinning || credits < bet;
        betUpBtn.disabled = isSpinning || bet >= Math.min(credits, maxBet);
        betDownBtn.disabled = isSpinning || bet <= 10;
      }

      function showMessage(text, isWin = false){
        messageEl.textContent = text;
        messageEl.className = isWin ? 'text win' : 'text';
      }

      /* ===========
         Spin logic
         ===========
         Approach:
         - For each reel choose a random symbol index in the base unique symbols.
         - We move the inner container by a computed pixel distance (index * symbolHeight).
         - Because sequence is repeated many times, we ensure target index lands within range and uses a smooth transition.
      */
      function spin(){
        if(isSpinning) return;
        if(credits < bet) { showMessage('Not enough credits'); return; }

        isSpinning = true;
        credits -= bet;
        lastWin = 0;
        updateDisplay();
        showMessage('Spinning...');

        // UI: add spinning class for glow effects
        reelsEl.classList.add('spinning');

        // choose targets
        const results = [];
        const durations = [900, 1250, 1650]; // base durations (ms)
        innerElements.forEach((item, idx)=>{
          // pick a random symbol from the base symbols list
          const symbolIndex = Math.floor(Math.random() * symbols.length);
          results.push(symbolIndex);

          // We need to compute a translateY so a visual symbol lines in the center row.
          // We'll select an occurrence of that symbol somewhere in the repeated seq towards the bottom,
          // so the animation appears to spin "down" a few cycles and then land.
          // Find all indexes in seq matching the symbol index:
          const matches = [];
          item.seq.forEach((s, i) => {
            // match by label (safe)
            if(s.label === symbols[symbolIndex].label) matches.push(i);
          });

          // pick a match that is not too near start to create enough spin
          let chosen = matches.find(i => i > item.seq.length * 0.35);
          if(chosen === undefined) chosen = matches[Math.floor(Math.random()*matches.length)] || 0;

          // compute target offset (so that the chosen symbol aligns center)
          // center offset = (chosenIndex * symbolHeight) - (reelHeight/2 - symbolHeight/2)
          const reelEl = item.inner.parentElement;
          const reelRect = reelEl.getBoundingClientRect();
          const reelHeight = reelRect.height || symbolHeight;
          const centerOffset = Math.round((chosen * symbolHeight) - (reelHeight/2 - symbolHeight/2));

          // add extra cycles to mimic spin (increase offset)
          const extraCycles = Math.floor(Math.random()*2 + 2); // 2 or 3 extra cycles
          const totalOffset = centerOffset + extraCycles * (item.seq.length) * symbolHeight;

          // set transition duration slightly randomized for each reel
          const dur = durations[idx] + Math.floor(Math.random()*300);

          // apply transition
          item.inner.style.transition = `transform ${dur}ms cubic-bezier(.2,.9,.2,1)`;
          // trigger layout then set transform
          requestAnimationFrame(()=> {
            item.inner.style.transform = `translateY(-${totalOffset}px)`;
          });
        });

        // finalization after last reel stops
        const longest = Math.max(1650, ...durations) + 400;
        setTimeout(()=> {
          // determine win
          checkWin(results);
          // cleanup
          reelsEl.classList.remove('spinning');
          isSpinning = false;
          updateDisplay();
        }, longest + 120);
      }

      function checkWin(results){
        // results are symbol indexes
        const first = symbols[results[0]];
        const second = symbols[results[1]];
        const third = symbols[results[2]];

        // simple rules: three of same = jackpot, two in a row = small win
        if(first.icon === second.icon && second.icon === third.icon){
          const winAmt = bet * first.payout;
          credits += winAmt;
          lastWin = winAmt;
          showMessage(`ðŸŽ‰ JACKPOT! Won ${winAmt} Credits!`, true);
          showWinLine();
          createConfetti();
        } else if(first.icon === second.icon || second.icon === third.icon){
          const winAmt = bet * 2;
          credits += winAmt;
          lastWin = winAmt;
          showMessage(`Win! ${winAmt} Credits!`, true);
          showWinLine();
        } else {
          showMessage('Try Again!');
        }
      }

      function showWinLine(){
        // flash win lines briefly
        winLines.forEach(w => w.classList.add('active'));
        setTimeout(()=>winLines.forEach(w => w.classList.remove('active')), 1600);
      }

      /* =========
         Bet control
         ========= */
      function increaseBet(){
        if(isSpinning) return;
        bet = clamp(bet + 10, 10, Math.min(credits, maxBet));
        updateDisplay();
      }

      function decreaseBet(){
        if(isSpinning) return;
        bet = clamp(bet - 10, 10, Math.min(credits, maxBet));
        updateDisplay();
      }

      /* =======
         Events
         ======= */
      spinBtn.addEventListener('click', spin);
      betUpBtn.addEventListener('click', increaseBet);
      betDownBtn.addEventListener('click', decreaseBet);

      // keyboard shortcuts: S to spin
      window.addEventListener('keydown', (e)=>{
        if(e.key.toLowerCase() === 's' && document.activeElement.tagName !== 'INPUT' && !isSpinning){
          spin();
        }
      });

      // recalc layout on resize (debounced)
      let resizeTimer;
      window.addEventListener('resize', ()=> {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(()=> {
          buildReels(); // rebuild to recalc heights so transitions match
        }, 220);
      });

      /* ====================
         Initial setup & boot
         ==================== */
      function init(){
        buildPaytable();
        buildReels();
        createParticles();
        updateDisplay();
      }

      // run init on DOM ready
      if(document.readyState === 'loading'){
        document.addEventListener('DOMContentLoaded', init);
      } else init();

      // expose for debugging (optional)
      window.PNPL = {
        spin, increaseBet, decreaseBet, getState: ()=>({credits,bet,lastWin,isSpinning})
      };

    })();
  </script>
</body>
</html>
